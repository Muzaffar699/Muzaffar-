<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Muzaffar OS</title>
<style>
  body { margin:0; font-family:sans-serif; background: linear-gradient(135deg,#74ebd5,#ACB6E5); overflow:hidden; }
  #desktop { position:relative; width:100%; height:100vh; overflow:hidden; }
  .icon { position:absolute; width:80px; text-align:center; cursor:pointer; color:#fff; font-size:12px; transition: transform 0.2s; }
  .icon:hover { transform: scale(1.1); }
  .icon img { width:60px; height:60px; margin-bottom:5px; }
  .app { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:#f0f0f0; z-index:1000; overflow:auto; transition:all 0.3s ease; }
  .app-header { background:#1c92d2; color:#fff; padding:10px; font-size:18px; position:sticky; top:0; display:flex; justify-content:space-between; align-items:center; }
  .close-btn { background:#fff; color:#1c92d2; border:none; font-size:18px; width:30px; height:30px; border-radius:50%; cursor:pointer; }
  .app-body { padding:10px; }
  input[type=text], input[type=url] { padding:8px; width:100%; margin:5px 0; border:1px solid #ccc; border-radius:4px; }
  button { padding:8px 15px; margin:3px; cursor:pointer; border:none; border-radius:5px; background:#1c92d2; color:#fff; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
  .setting-section { background:#fff; margin:10px 0; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  .setting-title { font-weight:bold; margin-bottom:10px; color:#1c92d2; }
  .setting-item { margin:10px 0; }
  .url-input-group { display:flex; gap:10px; margin:10px 0; }
  .url-input-group input { flex:1; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è iframe */
  .app-iframe { width:100%; height:90vh; border:none; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π */
  .create-app-form { background:#f8f9fa; padding:15px; border-radius:8px; margin:10px 0; }
  .form-group { margin:10px 0; }
  .form-group label { display:block; margin-bottom:5px; font-weight:bold; }
  .app-list { margin-top:20px; }
  .app-item { display:flex; justify-content:space-between; align-items:center; padding:10px; background:#fff; margin:5px 0; border-radius:5px; border:1px solid #ddd; }
  .delete-btn { background:#ff6b6b; color:white; border:none; padding:5px 10px; border-radius:3px; cursor:pointer; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–∫–æ–Ω–∫–∏ */
  .icon-selection { display:grid; grid-template-columns:repeat(auto-fill, minmax(60px, 1fr)); gap:10px; margin:10px 0; }
  .icon-option { width:60px; height:60px; object-fit:cover; border-radius:8px; cursor:pointer; border:2px solid transparent; }
  .icon-option.selected { border-color:#1c92d2; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–º–µ—Ä—ã */
  .camera-container { text-align:center; }
  .camera-preview { width:100%; max-width:500px; height:auto; background:#000; margin:10px auto; }
  .camera-controls { display:flex; justify-content:center; gap:10px; margin:15px 0; }
  .camera-switch { background:#333; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer; }
  .capture-btn { background:#1c92d2; color:white; border:none; width:60px; height:60px; border-radius:50%; font-size:24px; cursor:pointer; }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ */
  .gallery-container { display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:10px; padding:10px; }
  .gallery-item { width:100%; height:150px; object-fit:cover; border-radius:5px; cursor:pointer; }
  .gallery-fullscreen { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; display:flex; justify-content:center; align-items:center; flex-direction:column; }
  .gallery-fullscreen img { max-width:90%; max-height:80%; }
  .gallery-close { position:absolute; top:20px; right:20px; background:#fff; color:#000; border:none; width:40px; height:40px; border-radius:50%; font-size:20px; cursor:pointer; }
</style>
</head>
<body>
<div id="desktop">
  <!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
</div>

<!-- ------------------------ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ------------------------ -->
<div id="settingsApp" class="app">
  <div class="app-header">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ <button class="close-btn" onclick="closeApp('settingsApp')">√ó</button></div>
  <div class="app-body">
    
    <div class="setting-section">
      <div class="setting-title">üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏</div>
      
      <div class="create-app-form">
        <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
        <div class="form-group">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</label>
          <input type="text" id="appName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: YouTube">
        </div>
        <div class="form-group">
          <label>URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</label>
          <input type="url" id="appUrl" placeholder="https://example.com">
        </div>
        <div class="form-group">
          <label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É:</label>
          <div class="icon-selection" id="iconSelection">
            <!-- –ò–∫–æ–Ω–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
          </div>
        </div>
        <button onclick="createNewApp()">‚ûï –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
      </div>
      
      <div class="app-list">
        <h3>–ú–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
        <div id="appsList">
          <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        </div>
      </div>
    </div>

    <div class="setting-section">
      <div class="setting-title">üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</div>
      <div class="setting-item">
        <label>–û–±–æ–∏:</label>
        <select id="wallpaperSelect">
          <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
          <option value="blue">–°–∏–Ω–∏–π</option>
          <option value="nature">–ü—Ä–∏—Ä–æ–¥–∞</option>
          <option value="space">–ö–æ—Å–º–æ—Å</option>
          <option value="dark">–¢–µ–º–Ω—ã–π</option>
        </select>
      </div>
    </div>
    
    <div class="setting-section">
      <div class="setting-title">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
      <button onclick="clearAllApps()" style="background:#ff6b6b;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</button>
    </div>
  </div>
</div>

<!-- ------------------------ Muzaffar OS App ------------------------ -->
<div id="muzaffarOSApp" class="app">
  <div class="app-header">
    üåê Muzaffar OS
    <button class="close-btn" onclick="closeApp('muzaffarOSApp')">√ó</button>
  </div>
  <div class="app-body">
    <iframe src="https://muzaffar699.github.io/Muzaffar-/index.html" class="app-iframe"></iframe>
  </div>
</div>

<!-- ------------------------ Muzaffar Bank App ------------------------ -->
<div id="bankApp" class="app">
  <div class="app-header">
    üè¶ Muzaffar Bank
    <button class="close-btn" onclick="closeApp('bankApp')">√ó</button>
  </div>
  <div class="app-body">
    <iframe src="https://muzaffar699.github.io/Muzaffar-/Muzaffarbank" class="app-iframe"></iframe>
  </div>
</div>

<!-- ------------------------ –ö–∞–º–µ—Ä–∞ App ------------------------ -->
<div id="cameraApp" class="app">
  <div class="app-header">
    üì∑ –ö–∞–º–µ—Ä–∞
    <button class="close-btn" onclick="closeApp('cameraApp')">√ó</button>
  </div>
  <div class="app-body camera-container">
    <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
    <div class="camera-controls">
      <button class="camera-switch" onclick="switchCamera()">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
      <button class="capture-btn" onclick="capturePhoto()">üì∏</button>
    </div>
    <canvas id="cameraCanvas" style="display:none;"></canvas>
  </div>
</div>

<!-- ------------------------ –ì–∞–ª–µ—Ä–µ—è App ------------------------ -->
<div id="galleryApp" class="app">
  <div class="app-header">
    üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è
    <button class="close-btn" onclick="closeApp('galleryApp')">√ó</button>
  </div>
  <div class="app-body">
    <div id="galleryContainer" class="gallery-container">
      <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
    </div>
  </div>
</div>

<!-- ------------------------ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ ------------------------ -->
<div id="fullscreenView" class="gallery-fullscreen" style="display:none;">
  <button class="gallery-close" onclick="closeFullscreen()">√ó</button>
  <img id="fullscreenImage" src="" alt="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä">
  <button onclick="deletePhoto()" style="background:#ff6b6b; margin-top:20px;">–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ</button>
</div>

<script>
  // ------------------------ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ------------------------
  let userApps = JSON.parse(localStorage.getItem('muzaffar_user_apps') || '[]');
  let nextPosition = { x: 40, y: 40 };
  const GRID_SIZE = 100;
  
  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–∞–º–µ—Ä—ã
  let currentStream = null;
  let facingMode = 'environment';
  let currentPhotoId = null;
  
  // –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–∫–æ–Ω–∫–∏
  const availableIcons = [
    'https://img.icons8.com/fluency/96/application.png',
    'https://img.icons8.com/fluency/96/internet.png',
    'https://img.icons8.com/fluency/96/youtube.png',
    'https://img.icons8.com/fluency/96/google-logo.png',
    'https://img.icons8.com/fluency/96/gmail.png',
    'https://img.icons8.com/fluency/96/facebook.png',
    'https://img.icons8.com/fluency/96/instagram.png',
    'https://img.icons8.com/fluency/96/twitter.png',
    'https://img.icons8.com/fluency/96/spotify.png',
    'https://img.icons8.com/fluency/96/netflix.png',
    'https://img.icons8.com/fluency/96/calculator.png',
    'https://img.icons8.com/fluency/96/calendar.png',
    'https://img.icons8.com/fluency/96/clock.png',
    'https://img.icons8.com/fluency/96/weather.png',
    'https://img.icons8.com/fluency/96/map.png'
  ];

  // ------------------------ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ------------------------
  document.addEventListener('DOMContentLoaded', function() {
    loadUserApps();
    updateAppsList();
    loadGallery();
    loadIconSelection();
  });

  // ------------------------ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ ------------------------
  function loadUserApps() {
    const desktop = document.getElementById('desktop');
    
    // –û—á–∏—â–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø (–∫—Ä–æ–º–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
    const existingIcons = desktop.querySelectorAll('.icon:not([data-fixed])');
    existingIcons.forEach(icon => icon.remove());
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    userApps.forEach(app => {
      createAppIcon(app);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    createFixedApps();
  }

  function createAppIcon(app) {
    const desktop = document.getElementById('desktop');
    const icon = document.createElement('div');
    icon.className = 'icon';
    icon.style.left = app.position.x + 'px';
    icon.style.top = app.position.y + 'px';
    icon.setAttribute('data-app-id', app.id);
    
    icon.innerHTML = `
      <img src="${app.icon}" alt="${app.name}">
      <div>${app.name}</div>
    `;
    
    icon.onclick = () => openCustomApp(app);
    desktop.appendChild(icon);
    
    // –°–æ–∑–¥–∞–µ–º iframe –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    createAppIframe(app);
  }

  function createAppIframe(app) {
    // –î–ª—è –Ω–µ-iframe –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–µ —Å–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    if (app.id && app.id.startsWith('fixed_')) return;
    
    const iframe = document.createElement('iframe');
    iframe.id = `appFrame_${app.id}`;
    iframe.className = 'app-iframe';
    iframe.src = app.url;
    
    const appContainer = document.createElement('div');
    appContainer.id = `app_${app.id}`;
    appContainer.className = 'app';
    appContainer.innerHTML = `
      <div class="app-header">
        ${app.name}
        <button class="close-btn" onclick="closeApp('app_${app.id}')">√ó</button>
      </div>
      <div class="app-body"></div>
    `;
    
    appContainer.querySelector('.app-body').appendChild(iframe);
    document.body.appendChild(appContainer);
  }

  function createFixedApps() {
    const desktop = document.getElementById('desktop');
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const settingsIcon = createFixedAppIcon('settings', 'https://img.icons8.com/fluency/96/settings.png', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏', 'settingsApp', 40, 40);
    desktop.appendChild(settingsIcon);
    
    // Muzaffar OS
    const osIcon = createFixedAppIcon('muzaffarOS', 'https://img.icons8.com/fluency/96/os.png', 'Muzaffar OS', 'muzaffarOSApp', 140, 40);
    desktop.appendChild(osIcon);
    
    // Muzaffar Bank
    const bankIcon = createFixedAppIcon('bank', 'https://img.icons8.com/fluency/96/bank.png', 'Muzaffar Bank', 'bankApp', 240, 40);
    desktop.appendChild(bankIcon);
    
    // –ö–∞–º–µ—Ä–∞
    const cameraIcon = createFixedAppIcon('camera', 'https://img.icons8.com/fluency/96/camera.png', '–ö–∞–º–µ—Ä–∞', 'cameraApp', 340, 40);
    desktop.appendChild(cameraIcon);
    
    // –ì–∞–ª–µ—Ä–µ—è
    const galleryIcon = createFixedAppIcon('gallery', 'https://img.icons8.com/fluency/96/picture.png', '–ì–∞–ª–µ—Ä–µ—è', 'galleryApp', 440, 40);
    desktop.appendChild(galleryIcon);
  }

  function createFixedAppIcon(id, iconUrl, name, appId, x, y) {
    const icon = document.createElement('div');
    icon.className = 'icon';
    icon.style.left = x + 'px';
    icon.style.top = y + 'px';
    icon.setAttribute('data-fixed', 'true');
    
    icon.innerHTML = `
      <img src="${iconUrl}" alt="${name}">
      <div>${name}</div>
    `;
    
    icon.onclick = () => openApp(appId);
    return icon;
  }

  function loadIconSelection() {
    const iconSelection = document.getElementById('iconSelection');
    iconSelection.innerHTML = '';
    
    availableIcons.forEach(iconUrl => {
      const img = document.createElement('img');
      img.src = iconUrl;
      img.className = 'icon-option';
      img.onclick = function() {
        // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫
        document.querySelectorAll('.icon-option').forEach(icon => {
          icon.classList.remove('selected');
        });
        // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É
        this.classList.add('selected');
      };
      iconSelection.appendChild(img);
    });
  }

  function createNewApp() {
    const name = document.getElementById('appName').value.trim();
    const url = document.getElementById('appUrl').value.trim();
    
    // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∏–∫–æ–Ω–∫—É
    const selectedIcon = document.querySelector('.icon-option.selected');
    const icon = selectedIcon ? selectedIcon.src : availableIcons[0];
    
    if (!name || !url) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
      return;
    }
    
    if (!selectedIcon) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
      return;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
    const position = getNextPosition();
    
    const newApp = {
      id: Date.now().toString(),
      name: name,
      url: url,
      icon: icon,
      position: position
    };
    
    userApps.push(newApp);
    saveUserApps();
    createAppIcon(newApp);
    updateAppsList();
    
    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
    document.getElementById('appName').value = '';
    document.getElementById('appUrl').value = '';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏
    document.querySelectorAll('.icon-option').forEach(icon => {
      icon.classList.remove('selected');
    });
    
    alert(`–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "${name}" —Å–æ–∑–¥–∞–Ω–æ!`);
  }

  function getNextPosition() {
    const positions = userApps.map(app => app.position);
    let x = 40, y = 140;
    let foundPosition = false;
    
    while (!foundPosition) {
      const positionExists = positions.some(pos => pos.x === x && pos.y === y);
      if (!positionExists) {
        foundPosition = true;
      } else {
        x += GRID_SIZE;
        if (x > 500) {
          x = 40;
          y += GRID_SIZE;
        }
      }
    }
    
    return { x: x, y: y };
  }

  function deleteApp(appId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?')) {
      userApps = userApps.filter(app => app.id !== appId);
      saveUserApps();
      
      // –£–¥–∞–ª—è–µ–º –∏–∫–æ–Ω–∫—É
      const icon = document.querySelector(`[data-app-id="${appId}"]`);
      if (icon) icon.remove();
      
      // –£–¥–∞–ª—è–µ–º iframe
      const appContainer = document.getElementById(`app_${appId}`);
      if (appContainer) appContainer.remove();
      
      updateAppsList();
    }
  }

  function updateAppsList() {
    const appsList = document.getElementById('appsList');
    appsList.innerHTML = '';
    
    if (userApps.length === 0) {
      appsList.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</p>';
      return;
    }
    
    userApps.forEach(app => {
      const appItem = document.createElement('div');
      appItem.className = 'app-item';
      appItem.innerHTML = `
        <div>
          <strong>${app.name}</strong><br>
          <small>${app.url}</small>
        </div>
        <button class="delete-btn" onclick="deleteApp('${app.id}')">–£–¥–∞–ª–∏—Ç—å</button>
      `;
      appsList.appendChild(appItem);
    });
  }

  function saveUserApps() {
    localStorage.setItem('muzaffar_user_apps', JSON.stringify(userApps));
  }

  // ------------------------ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞–º–∏ ------------------------
  function openApp(id) {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    if (id !== 'cameraApp' && currentStream) {
      stopCamera();
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
    if (id === 'cameraApp' && !currentStream) {
      startCamera();
    }
    
    document.getElementById(id).style.display = 'block';
  }

  function openCustomApp(app) {
    document.getElementById(`app_${app.id}`).style.display = 'block';
  }

  function closeApp(id) {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
    if (id === 'cameraApp' && currentStream) {
      stopCamera();
    }
    
    document.getElementById(id).style.display = 'none';
  }

  // ------------------------ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ------------------------
  function clearAllApps() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è?')) {
      userApps = [];
      saveUserApps();
      loadUserApps();
      updateAppsList();
      alert('–í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã!');
    }
  }

  // ------------------------ –ö–∞–º–µ—Ä–∞ ------------------------
  async function startCamera() {
    try {
      const constraints = {
        video: { 
          facingMode: facingMode,
          width: { ideal: 1280 },
          height: { ideal: 720 }
        }
      };
      
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      const video = document.getElementById('cameraPreview');
      video.srcObject = stream;
      currentStream = stream;
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:", err);
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.");
    }
  }

  function stopCamera() {
    if (currentStream) {
      currentStream.getTracks().forEach(track => track.stop());
      currentStream = null;
    }
  }

  function switchCamera() {
    facingMode = facingMode === 'environment' ? 'user' : 'environment';
    stopCamera();
    startCamera();
  }

  function capturePhoto() {
    const video = document.getElementById('cameraPreview');
    const canvas = document.getElementById('cameraCanvas');
    const context = canvas.getContext('2d');
    
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0, canvas.width, canvas.height);
    
    const photoData = canvas.toDataURL('image/png');
    savePhoto(photoData);
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
    alert('–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –≥–∞–ª–µ—Ä–µ—é!');
  }

  // ------------------------ –ì–∞–ª–µ—Ä–µ—è ------------------------
  function savePhoto(photoData) {
    const photos = JSON.parse(localStorage.getItem('muzaffar_photos') || '[]');
    const newPhoto = {
      id: Date.now().toString(),
      data: photoData,
      date: new Date().toLocaleString()
    };
    
    photos.unshift(newPhoto);
    localStorage.setItem('muzaffar_photos', JSON.stringify(photos));
    loadGallery();
  }

  function loadGallery() {
    const galleryContainer = document.getElementById('galleryContainer');
    const photos = JSON.parse(localStorage.getItem('muzaffar_photos') || '[]');
    
    galleryContainer.innerHTML = '';
    
    if (photos.length === 0) {
      galleryContainer.innerHTML = '<p>–í –≥–∞–ª–µ—Ä–µ–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ñ–æ—Ç–æ</p>';
      return;
    }
    
    photos.forEach(photo => {
      const img = document.createElement('img');
      img.src = photo.data;
      img.alt = '–§–æ—Ç–æ';
      img.className = 'gallery-item';
      img.onclick = () => openFullscreen(photo.id, photo.data);
      galleryContainer.appendChild(img);
    });
  }

  function openFullscreen(photoId, photoData) {
    currentPhotoId = photoId;
    document.getElementById('fullscreenImage').src = photoData;
    document.getElementById('fullscreenView').style.display = 'flex';
  }

  function closeFullscreen() {
    document.getElementById('fullscreenView').style.display = 'none';
    currentPhotoId = null;
  }

  function deletePhoto() {
    if (!currentPhotoId) return;
    
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ñ–æ—Ç–æ?')) {
      let photos = JSON.parse(localStorage.getItem('muzaffar_photos') || '[]');
      photos = photos.filter(photo => photo.id !== currentPhotoId);
      localStorage.setItem('muzaffar_photos', JSON.stringify(photos));
      loadGallery();
      closeFullscreen();
    }
  }

  // ------------------------ –û–±–æ–∏ ------------------------
  document.getElementById('wallpaperSelect').addEventListener('change', function() {
    const wallpaper = this.value;
    let gradient = 'linear-gradient(135deg,#74ebd5,#ACB6E5)';
    
    if (wallpaper === 'blue') {
      gradient = 'linear-gradient(135deg,#1c92d2,#f2fcfe)';
    } else if (wallpaper === 'nature') {
      gradient = 'linear-gradient(135deg,#56ab2f,#a8e063)';
    } else if (wallpaper === 'space') {
      gradient = 'linear-gradient(135deg,#0f2027,#203a43,#2c5364)';
    } else if (wallpaper === 'dark') {
      gradient = 'linear-gradient(135deg,#2c3e50,#34495e)';
    }
    
    document.body.style.background = gradient;
    localStorage.setItem('muzaffar_wallpaper', wallpaper);
  });
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ–±–æ–∏
  const savedWallpaper = localStorage.getItem('muzaffar_wallpaper') || 'gradient';
  document.getElementById('wallpaperSelect').value = savedWallpaper;
  document.getElementById('wallpaperSelect').dispatchEvent(new Event('change'));
</script>
</body>
</html>
