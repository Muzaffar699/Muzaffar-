<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>JARVIS Ultimate v9</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<style>
body { background:#111; color:#0ff; font-family:Consolas, monospace; text-align:center; }
h1 { text-shadow:0 0 15px #0ff; margin-top:20px; font-size:3em; }
video, canvas { position:fixed; bottom:10px; right:10px; width:300px; border:2px solid #0ff; border-radius:10px; transform:scaleX(-1);}
button { margin-top:20px; padding:10px 30px; font-size:20px; background:#0ff; color:#000; border:none; border-radius:12px; cursor:pointer; transition:0.3s; }
button:hover { background:#0aa; color:#fff; }
#status { margin-top:20px; font-size:18px; }
#player { margin-top:20px; width:560px; height:315px; border:2px solid #0ff; border-radius:10px; display:none; }
</style>
</head>
<body>
<h1>üß† Muzaffar ai</h1>
<p id="status">–ù–∞–∂–º–∏ "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å", —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–æ–ª–æ—Å –∏ –∫–∞–º–µ—Ä—É.</p>
<div id="player"></div>
<video id="video" autoplay></video>
<canvas id="canvas"></canvas>
<button id="startBtn">üöÄ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>

<script>
let currentVolume = 1.0;
const synth = window.speechSynthesis;
let hasSpokenReady = false;
let recognition;
let player;
let isPlayerReady = false;

function speak(text) {
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "ru-RU";
  msg.rate = 1.0;
  msg.volume = currentVolume;
  synth.speak(msg);
}

// === YouTube API ===
function onYouTubeIframeAPIReady() {
  player = new YT.Player("player", {
    height: "315",
    width: "560",
    videoId: "Hd5nXTyaXZg",
    events: { onReady: () => { isPlayerReady = true; } }
  });
}

// === –ì–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ===
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
function startRecognition() {
  recognition = new SpeechRecognition();
  recognition.lang = "ru-RU";
  recognition.continuous = true;
  recognition.interimResults = false;

  recognition.onresult = event => {
    const phrase = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
    document.getElementById("status").textContent = "üó£Ô∏è " + phrase;
    processCommand(phrase);
  };

  recognition.onerror = e => console.warn("Speech error:", e.error);
  recognition.onend = () => setTimeout(()=>recognition.start(), 250);
  recognition.start();

  if (!hasSpokenReady) { speak("–ì–æ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—Ç—å, —Å—ç—Ä"); hasSpokenReady = true; }
}

// === –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ ===
function processCommand(phrase) {
  // --- –ú—É–∑—ã–∫–∞ / YouTube ---
  if (phrase.includes("–º—É–∑—ã–∫–∞")) {
    if (isPlayerReady) { document.getElementById("player").style.display="block"; player.playVideo(); speak("–í–∫–ª—é—á–∞—é –º—É–∑—ã–∫—É, —Å—ç—Ä"); }
  } else if (phrase.includes("–ø–∞—É–∑–∞") && isPlayerReady) { player.pauseVideo(); speak("–ú—É–∑—ã–∫–∞ –Ω–∞ –ø–∞—É–∑–µ, —Å—ç—Ä"); }
  else if (phrase.includes("–ø—Ä–æ–¥–æ–ª–∂–∞–π") && isPlayerReady) { player.playVideo(); speak("–ü—Ä–æ–¥–æ–ª–∂–∞—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ, —Å—ç—Ä"); }
  else if (phrase.includes("–æ—Å—Ç–∞–Ω–æ–≤–∏ –º—É–∑—ã–∫—É") && isPlayerReady) { player.stopVideo(); speak("–ú—É–∑—ã–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, —Å—ç—Ä"); }
  else if (phrase.includes("–≥—Ä–æ–º—á–µ") && isPlayerReady) { let v=player.getVolume(); player.setVolume(Math.min(100,v+10)); speak("–ì—Ä–æ–º–∫–æ—Å—Ç—å "+player.getVolume()+"%, —Å—ç—Ä"); }
  else if (phrase.includes("—Ç–∏—à–µ") && isPlayerReady) { let v=player.getVolume(); player.setVolume(Math.max(0,v-10)); speak("–ì—Ä–æ–º–∫–æ—Å—Ç—å "+player.getVolume()+"%, —Å—ç—Ä"); }

  // --- –°–∞–π—Ç—ã ---
  else if (phrase.includes("–¥–æ–º–æ–π")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é –≤–∞—à —Å–∞–π—Ç —Å—ç—Ä"); window.open("https://muzaffar699.github.io/Muzaffar-/","_blank"); }
  else if (phrase.includes("youtube")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é YouTube —Å—ç—Ä"); window.open("https://youtube.com","_blank"); }
else if (phrase.includes("–∑–∞ —Ä–∞–±–æ—Ç—É")) { speak("–ø—Ä–æ–¥–æ–ª–∂–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å—ç—Ä");window.open("https://htmleditor.gitlab.io/","_blank"); }
  else if (phrase.includes("telegram")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é Telegram, —Å—ç—Ä"); window.open("https://web.telegram.org/","_blank"); }
  else if (phrase.includes("–≤–∫")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, —Å—ç—Ä"); window.open("https://vk.com/feed","_blank"); }
  else if (phrase.includes("–¥–∏—Å–∫–æ—Ä–¥")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é Discord, —Å—ç—Ä"); window.open("https://discord.com/app","_blank"); }
  else if (phrase.includes("–¥–æ–∫—É–º–µ–Ω—Ç—ã")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é Google –î–æ–∫—É–º–µ–Ω—Ç—ã, —Å—ç—Ä"); window.open("https://docs.google.com/","_blank"); }
  else if (phrase.includes("–Ω–æ–≤–æ—Å—Ç–∏")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é –Ω–æ–≤–æ—Å—Ç–∏, —Å—ç—Ä"); window.open("https://muzaffar699.github.io/Muzaffar-/nevs.html","_blank"); }
  else if (phrase.includes("–±–∞–Ω–∫")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é –±–∞–Ω–∫, —Å—ç—Ä"); window.open("https://muzaffar699.github.io/Muzaffar-/Muzaffarbank","_blank"); }
  else if (phrase.includes("–ø–æ–≥–æ–¥—É")) { speak("–û—Ç–∫—Ä—ã–≤–∞—é –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã, —Å—ç—Ä"); window.open("https://www.google.com/search?q=–ø–æ–≥–æ–¥–∞","_blank"); }

  // --- –§–æ—Ç–æ ---
  else if (phrase.includes("—Å–¥–µ–ª–∞–π —Ñ–æ—Ç–æ")) { takeSnapshot(); }

  // --- –û—Ç–≤–µ—Ç—ã ---
  else if (phrase.includes("–≤—Ä–µ–º—è")) { const now=new Date(); speak(`–°—ç—Ä, —Å–µ–π—á–∞—Å ${now.getHours()} —á–∞—Å–æ–≤ ${now.getMinutes()} –º–∏–Ω—É—Ç`); }
  else if (phrase.includes("—Å–ø–∞—Å–∏–±–æ")) { speak("–í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å, —Å—ç—Ä"); }
  else if (phrase.includes("–∫–∞–∫ –¥–µ–ª–∞")) { speak("–†–∞–±–æ—Ç–∞—é —Å—Ç–∞–±–∏–ª—å–Ω–æ, —Å—ç—Ä. –ù–∞–¥–µ—é—Å—å, —É –≤–∞—Å —Ç–æ–∂–µ –≤—Å—ë —Ö–æ—Ä–æ—à–æ"); }
  else if (phrase.includes("–∫—Ç–æ —Ç–µ–±—è –≤—ã—Ä–∞—Å—Ç–∏–ª")) { speak("–ú–µ–Ω—è –≤—ã—Ä–∞—Å—Ç–∏–ª –®–∞—Ä–∏–ø–æ–≤ –ú—É–∑–∞—Ñ—Ñ–∞—Ä –ê–Ω–≤–∞—Ä–æ–≤–∏—á, —Å—ç—Ä"); }
  else if (phrase.includes("—Å—Ç–æ–ø")) { synth.cancel(); speak("–ö–∞–∫ –ø—Ä–∏–∫–∞–∂–µ—Ç–µ, —Å—ç—Ä"); }
}

// === –§–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã ===
function takeSnapshot() {
  const snapCanvas=document.createElement("canvas");
  snapCanvas.width=video.videoWidth;
  snapCanvas.height=video.videoHeight;
  const ctxSnap=snapCanvas.getContext("2d");
  ctxSnap.drawImage(video,0,0,snapCanvas.width,snapCanvas.height);
  const link=document.createElement("a");
  link.download="jarvis_snapshot.png";
  link.href=snapCanvas.toDataURL("image/png");
  link.click();
  speak("–§–æ—Ç–æ —Å–¥–µ–ª–∞–Ω–æ, —Å—ç—Ä");
}

// === –ö–∞–º–µ—Ä–∞ –∏ –∂–µ—Å—Ç—ã ===
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
let gestureCooldown=false;

async function startCamera() {
  const stream=await navigator.mediaDevices.getUserMedia({ video:{ facingMode:"user", width:640, height:480 }, audio:false });
  video.srcObject=stream;
  await new Promise(resolve=>video.onloadedmetadata=resolve);
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
}

function recognizeGesture(keypoints){
  const thumbTip=keypoints[4], indexTip=keypoints[8], middleTip=keypoints[12], ringTip=keypoints[16], pinkyTip=keypoints[20];
  if(indexTip.y<middleTip.y && middleTip.y<ringTip.y && ringTip.y<pinkyTip.y) return "–ü—Ä–∏–≤–µ—Ç";
  if(indexTip.y<middleTip.y && middleTip.y>ringTip.y) return "–ö–ª–∞—Å—Å";
  if(thumbTip.y>indexTip.y && indexTip.y>middleTip.y) return "–û—Ç–ª–∏—á–Ω–æ";
  return null;
}

async function detectHand() {
  const detector=await handPoseDetection.createDetector(handPoseDetection.SupportedModels.MediaPipeHands,{ runtime:"mediapipe", solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/hands" });
  setInterval(async()=>{
    const hands=await detector.estimateHands(video);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(hands.length>0){
      const keypoints=hands[0].keypoints;
      ctx.fillStyle="red";
      ctx.beginPath();
      ctx.arc(keypoints[0].x*canvas.width,keypoints[0].y*canvas.height,10,0,2*Math.PI);
      ctx.fill();
      const gesture=recognizeGesture(keypoints);
      if(gesture && !gestureCooldown){ gestureCooldown=true; speak(gesture+", —Å—ç—Ä"); setTimeout(()=>gestureCooldown=false,1500);}
    }
  },100);
}

document.getElementById("startBtn").onclick=()=>{
  startCamera().then(detectHand);
  startRecognition();
  document.getElementById("status").textContent="üéß –°–ª—É—à–∞—é –∏ –Ω–∞–±–ª—é–¥–∞—é...";
};
</script>
</body>
</html>
